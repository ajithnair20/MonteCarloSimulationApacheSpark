# Monte Carlo Profit Assessment

This project aims at creating creating a Spark program for parallel processing of the predictive engine for stock portfolio losses using Monte Carlo simulation in Spark.

# Setting up the environment
#### Compiling code and generating jar file
Open a terminal and clone the repository by using the following command:
```sh
$ git clone https://ajithnair08@bitbucket.org/ajithnair08/ajithjayaraman_nair_hw3.git
```
Traverse to the root directory of the project and compile the code and create jar of the application using the below commands:
```sh
$ sbt clean compile assembly
```
On running these commands, the test cases are run and a new "Target" folder is created which inclues the jar file. The results of the test cases are displayed in the terminal.
#### Setting up Spark
The simulation operations are performed on the Apache Spark platform. In order to perform the operations you need to setup HDFS and Spark on your system. Alternatively, you can use a virtual machine (VM) of [Hortonworks Sandbox](https://www.cloudera.com/downloads/hortonworks-sandbox.html), a preconfigured Apache Hadoop installation with a comprehensive software stack. To run the VM, you can install vmWare or VirtualBox. Instructions to setup hadoop on a Linux based system can found at [Installing Hadoop Guide.](https://www.ashessin.com/BD_STTP_2016/)
Instructions to install spark on Linux system can be found at [Installing Spark Guide](https://computingforgeeks.com/how-to-install-apache-spark-on-ubuntu-debian/)

After setting up spark and HDFS execute the below mentioned commands:

 Start HDFS and Hadoop YARN
```sh
$ start-dfs.sh
$ start-yarn.sh
```
Running spark requries HDFS and YARN services to be initiated.

# Running the Application
Traverse to the folder in which the jar file has been generated and perform the following command.
```sh
$ spark-submit --class MonteCarloSim --master yarn --deploy-mode client ./ajithjayaraman_nair_hw3_2.12-1.0.jar /outputpath/output.csv
```
The command is to run the spark application on yarn. MonteCarloSim is the name of the Main class and deploy mode is client. Here /outputpath/output.csv is the output path and file name of the output CSV file generated by the application. The output is the maximized output of the stocks initially invested by the user.

# Monte Carlo Simulation Operations
#### Algorithm
Monte Carlo simulation is a technique used to understand the impact of risk and uncertainty in financial, project management, cost, and other forecasting models. A Monte Carlo simulator helps one visualize most or all of the potential outcomes to have a better idea regarding the risk of a decision. A brief explanation of the algorithm and simulating the same using Microsoft Excel can be found at [Monte Carlo Simulation of Stock Price Movement](https://www.youtube.com/watch?v=IZLFxzwhOkg).
#### Implementation
In the current implementation, we take input in the form of symbol of the companies of which stocks we possess and initial investment amount. For the given example, we have taken initial investment amount to be same for all stocks. All inputs are taken through the configuration file.
Based on the companies given, we fetch data from [Alphavantage Finance API]("https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=COMPANYNAME&apikey=X5TH7YQYI9JWFX5D&datatype=csv&outputsize=full"). The data comprises of records of opening and closing and other data corresponding to a stock for a series of days for about 20 years. We then capture the change in closing price of the stocks with respect to the previous day and generate simulations based on the random set of change set. We generate multiple simulations in the order of 1000s to get relevant data.

Simulation results are generated at the path: _Outputpath/Simulation<CompanyName>/_
##### Simulation Results Excerpt:
```sh
Simulation 1	Simulation 2	Simulation 3	Simulation 4	Simulation 5
262.01	        262.01	        262.01	        262.01	        262.01
259.6226054	    276.2029961	    278.7002704	    266.0422193	    253.0872792
204.0633279	    278.3250018	    203.1146008	    259.4398859	    278.7677604
200.9948072	    315.1908686	    227.8616845	    260.8037984	    281.6135521
199.8382826	    321.1792462	    199.5171278	    230.6780533	    281.2497625
200.7469305	    320.4610137	    207.1891018	    228.1996001	    281.9182402
194.4852993	    318.9016281	    169.1002641	    219.495542	    281.8601696
182.1613686	    318.9645092	    171.1660999	    155.0337174	    281.6307297

```

The output of the program is the maximum profit generate for individual stocks. The output is generated at the path _Outputpath/Output/_
##### Output Excerpt:
```sh
+-------+------------------+
|Company|            Profit|
+-------+------------------+
|   MSFT|4064.9710566955496|
|   AAPL| 7340.317241434121|
|   AMZN|  879.151142422535|
|    IBM| 982.1640034627208|
+-------+------------------+
```

# Implementation on AWS EMR
You can refer to the [link](https://www.youtube.com/channel/UCCMaG94935rmZbMTQk9sI7g) for steps to setup Apache Spark Application using Amazon EMR. 